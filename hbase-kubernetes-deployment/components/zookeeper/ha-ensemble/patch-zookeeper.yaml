# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
---
- # increase container resource allocations
  op: replace
  path: /spec/template/spec/containers/0/resources
  value:
    requests:
      cpu: '1.0'
      memory: 1Gi
    limits:
      cpu: '2.0'
      memory: 4Gi
- # update the launch command
  op: add
  path: /spec/template/spec/containers/0/command
  value:
  - sh
  - -c
  - |-
    # Make the heap be a fraction of the requested memory size.
    # Make 'servers' count agree with replicas count.
    /usr/bin/zookeeper/start.sh --servers=5 --percentage=50 --max_client_cnxns=300 --quorum_listen_on_all_ips=true
- # increase storage volume size
  op: replace
  path: /spec/volumeClaimTemplates/0/spec/resources/requests/storage
  value: 5Gi
- # specify pod scheduling anti-affinity
  op: add
  path: /spec/template/spec/affinity
  value:
    podAntiAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
      - labelSelector:
          matchLabels:
            app: hadoop
            role: zookeeper
        topologyKey: kubernetes.io/hostname
